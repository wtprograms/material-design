import { Component, ChangeDetectionStrategy, ViewEncapsulation, forwardRef, model, viewChild, computed, Input, } from '@angular/core';
import { toSignal, toObservable } from '@angular/core/rxjs-interop';
import { FormsModule, NG_VALUE_ACCESSOR } from '@angular/forms';
import { combineLatest, merge, filter, switchMap, fromEvent, map } from 'rxjs';
import { attachTarget } from '../../directives/attachable.directive';
import { ForwardFocusDirective } from '../../directives/forward-focus.directive';
import { FieldComponent } from '../field/field.component';
import { MaterialDesignValueAccessorComponent } from '../material-design-value-accessor.component';
import { ListComponent } from '../list/list.component';
import { ListItemComponent } from '../list-item/list-item.component';
import { SlotDirective } from '../../directives/slot.directive';
import { CommonModule } from '@angular/common';
import { MaterialDesignComponent } from '../material-design.component';
import * as i0 from "@angular/core";
import * as i1 from "../../directives/forward-focus.directive";
import * as i2 from "@angular/forms";
export class TextFieldComponent extends MaterialDesignValueAccessorComponent {
    value = model();
    variant = model('filled');
    type = model('text');
    prefix = model();
    suffix = model();
    label = model();
    supportingText = model();
    maxLength = model();
    hasDropdown = model(false);
    selectedItemToTextFn = (value) => value;
    _input = viewChild('input');
    _field = viewChild(FieldComponent);
    counterText = computed(() => this.maxLength() && this._input()?.nativeElement
        ? `${this.value()?.length ?? 0}/${this.maxLength()}`
        : undefined);
    populated = toSignal(combineLatest({
        focused: merge(toObservable(this._input).pipe(filter((x) => !!x?.nativeElement), switchMap((x) => fromEvent(x.nativeElement, 'focus').pipe(map(() => true)))), toObservable(this._input).pipe(filter((x) => !!x?.nativeElement), switchMap((x) => fromEvent(x.nativeElement, 'blur').pipe(map(() => false))))),
        hasValue: toObservable(this.value).pipe(map((x) => !!x)),
    }).pipe(map((x) => x.focused || x.hasValue)));
    constructor() {
        super();
        attachTarget(ForwardFocusDirective, this._input);
        this.setSlots(ListItemComponent, (x) => {
            x.type.set('button');
            x.selected.set(x.value() === this.value());
        });
    }
    onContentClick() {
        this._input()?.nativeElement.focus();
    }
    onInput(event) {
        if (this.type() === 'text-area') {
            const target = event.target;
            target.style.height = 'auto';
            target.style.height = target.scrollHeight + 'px';
        }
        if (this.hasDropdown()) {
            if (!this._field()?.popover()?.open()) {
                this._field().popover().open.set(true);
            }
        }
    }
    onItemClick(event) {
        const item = MaterialDesignComponent.get(event.target);
        this.value.set(this.selectedItemToTextFn(item.value()));
    }
    static ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.9", ngImport: i0, type: TextFieldComponent, deps: [], target: i0.ɵɵFactoryTarget.Component });
    static ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "18.2.9", type: TextFieldComponent, isStandalone: true, selector: "md-text-field", inputs: { value: { classPropertyName: "value", publicName: "value", isSignal: true, isRequired: false, transformFunction: null }, variant: { classPropertyName: "variant", publicName: "variant", isSignal: true, isRequired: false, transformFunction: null }, type: { classPropertyName: "type", publicName: "type", isSignal: true, isRequired: false, transformFunction: null }, prefix: { classPropertyName: "prefix", publicName: "prefix", isSignal: true, isRequired: false, transformFunction: null }, suffix: { classPropertyName: "suffix", publicName: "suffix", isSignal: true, isRequired: false, transformFunction: null }, label: { classPropertyName: "label", publicName: "label", isSignal: true, isRequired: false, transformFunction: null }, supportingText: { classPropertyName: "supportingText", publicName: "supportingText", isSignal: true, isRequired: false, transformFunction: null }, maxLength: { classPropertyName: "maxLength", publicName: "maxLength", isSignal: true, isRequired: false, transformFunction: null }, hasDropdown: { classPropertyName: "hasDropdown", publicName: "hasDropdown", isSignal: true, isRequired: false, transformFunction: null }, selectedItemToTextFn: { classPropertyName: "selectedItemToTextFn", publicName: "selectedItemToTextFn", isSignal: false, isRequired: false, transformFunction: null } }, outputs: { value: "valueChange", variant: "variantChange", type: "typeChange", prefix: "prefixChange", suffix: "suffixChange", label: "labelChange", supportingText: "supportingTextChange", maxLength: "maxLengthChange", hasDropdown: "hasDropdownChange" }, host: { attributes: { "tabindex": "0" }, properties: { "attr.disabled": "disabled() || null" } }, providers: [
            {
                provide: NG_VALUE_ACCESSOR,
                multi: true,
                useExisting: forwardRef(() => TextFieldComponent),
            },
        ], viewQueries: [{ propertyName: "_input", first: true, predicate: ["input"], descendants: true, isSignal: true }, { propertyName: "_field", first: true, predicate: FieldComponent, descendants: true, isSignal: true }], usesInheritance: true, hostDirectives: [{ directive: i1.ForwardFocusDirective }], ngImport: i0, template: "<md-field [variant]=\"variant()\" [populated]=\"!!populated()\" [errorText]=\"errorText()\" [label]=\"label()\"\n  (contentClick)=\"onContentClick()\" [disabled]=\"disabled()\" popoverTrigger=\"manual\" [maxPopoverHeight]=\"300\">\n  <slot name=\"leading\" slot=\"leading\"></slot>\n\n  <slot name=\"prefix\" slot=\"prefix\"></slot>\n  <slot name=\"suffix\" slot=\"suffix\"></slot>\n  <slot name=\"supporting-text\" slot=\"supporting-text\"></slot>\n\n  @if (counterText()) {\n  <span slot=\"counter\">{{ counterText() }}</span>\n  }\n\n  @if (type() === 'text-area') {\n  <textarea #input [ngModel]=\"value()\" (ngModelChange)=\"value.set($event)\" rows=\"1\" (input)=\"onInput($event)\"\n    [disabled]=\"disabled()\"></textarea>\n  } @else {\n  <input #input [ngModel]=\"value()\" (ngModelChange)=\"value.set($event)\" [type]=\"type()\" [disabled]=\"disabled()\"\n    (input)=\"onInput($event)\">\n  }\n  <slot name=\"trailing\" slot=\"trailing\"></slot>\n  @if (hasDropdown()) {\n  <md-list slot=\"popover\">\n    <slot (click)=\"onItemClick($event)\"></slot>\n  </md-list>\n  }\n</md-field>", styles: [":host input,:host textarea{display:inline-flex;appearance:none;margin:0;padding:0;padding-inline:0;padding-block:0;border:0;outline:none;background-color:transparent;color:inherit;caret-color:inherit;resize:none;overflow:hidden;font-family:inherit;font-weight:inherit;font-size:inherit;box-sizing:border-box}:host input::placeholder,:host textarea::placeholder{color:currentColor;opacity:1}:host input::-webkit-calendar-picker-indicator,:host textarea::-webkit-calendar-picker-indicator{display:none}:host input::-webkit-search-decoration,:host input::-webkit-search-cancel-button,:host textarea::-webkit-search-decoration,:host textarea::-webkit-search-cancel-button{display:none}:host input::-webkit-inner-spin-button,:host input::-webkit-outer-spin-button,:host textarea::-webkit-inner-spin-button,:host textarea::-webkit-outer-spin-button{display:none}:host input[type=number],:host textarea[type=number]{-moz-appearance:textfield}:host md-field::part(content){cursor:text}:host([disabled=true]){pointer-events:none;cursor:default}\n"], dependencies: [{ kind: "component", type: FieldComponent, selector: "md-field", inputs: ["value", "variant", "label", "populated", "open", "popoverTrigger", "maxPopoverHeight"], outputs: ["valueChange", "variantChange", "labelChange", "populatedChange", "contentClick", "bodyClick", "openChange", "popoverTriggerChange", "maxPopoverHeightChange", "popoverStateChange"] }, { kind: "ngmodule", type: FormsModule }, { kind: "directive", type: i2.DefaultValueAccessor, selector: "input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]" }, { kind: "directive", type: i2.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i2.NgModel, selector: "[ngModel]:not([formControlName]):not([formControl])", inputs: ["name", "disabled", "ngModel", "ngModelOptions"], outputs: ["ngModelChange"], exportAs: ["ngModel"] }, { kind: "component", type: ListComponent, selector: "md-list" }, { kind: "directive", type: SlotDirective, selector: "slot", inputs: ["name", "slot"] }, { kind: "ngmodule", type: CommonModule }], changeDetection: i0.ChangeDetectionStrategy.OnPush, encapsulation: i0.ViewEncapsulation.ShadowDom });
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.9", ngImport: i0, type: TextFieldComponent, decorators: [{
            type: Component,
            args: [{ selector: 'md-text-field', standalone: true, changeDetection: ChangeDetectionStrategy.OnPush, encapsulation: ViewEncapsulation.ShadowDom, imports: [
                        FieldComponent,
                        FormsModule,
                        ListComponent,
                        SlotDirective,
                        CommonModule,
                    ], host: {
                        '[attr.disabled]': 'disabled() || null',
                        tabindex: '0',
                    }, hostDirectives: [ForwardFocusDirective], providers: [
                        {
                            provide: NG_VALUE_ACCESSOR,
                            multi: true,
                            useExisting: forwardRef(() => TextFieldComponent),
                        },
                    ], template: "<md-field [variant]=\"variant()\" [populated]=\"!!populated()\" [errorText]=\"errorText()\" [label]=\"label()\"\n  (contentClick)=\"onContentClick()\" [disabled]=\"disabled()\" popoverTrigger=\"manual\" [maxPopoverHeight]=\"300\">\n  <slot name=\"leading\" slot=\"leading\"></slot>\n\n  <slot name=\"prefix\" slot=\"prefix\"></slot>\n  <slot name=\"suffix\" slot=\"suffix\"></slot>\n  <slot name=\"supporting-text\" slot=\"supporting-text\"></slot>\n\n  @if (counterText()) {\n  <span slot=\"counter\">{{ counterText() }}</span>\n  }\n\n  @if (type() === 'text-area') {\n  <textarea #input [ngModel]=\"value()\" (ngModelChange)=\"value.set($event)\" rows=\"1\" (input)=\"onInput($event)\"\n    [disabled]=\"disabled()\"></textarea>\n  } @else {\n  <input #input [ngModel]=\"value()\" (ngModelChange)=\"value.set($event)\" [type]=\"type()\" [disabled]=\"disabled()\"\n    (input)=\"onInput($event)\">\n  }\n  <slot name=\"trailing\" slot=\"trailing\"></slot>\n  @if (hasDropdown()) {\n  <md-list slot=\"popover\">\n    <slot (click)=\"onItemClick($event)\"></slot>\n  </md-list>\n  }\n</md-field>", styles: [":host input,:host textarea{display:inline-flex;appearance:none;margin:0;padding:0;padding-inline:0;padding-block:0;border:0;outline:none;background-color:transparent;color:inherit;caret-color:inherit;resize:none;overflow:hidden;font-family:inherit;font-weight:inherit;font-size:inherit;box-sizing:border-box}:host input::placeholder,:host textarea::placeholder{color:currentColor;opacity:1}:host input::-webkit-calendar-picker-indicator,:host textarea::-webkit-calendar-picker-indicator{display:none}:host input::-webkit-search-decoration,:host input::-webkit-search-cancel-button,:host textarea::-webkit-search-decoration,:host textarea::-webkit-search-cancel-button{display:none}:host input::-webkit-inner-spin-button,:host input::-webkit-outer-spin-button,:host textarea::-webkit-inner-spin-button,:host textarea::-webkit-outer-spin-button{display:none}:host input[type=number],:host textarea[type=number]{-moz-appearance:textfield}:host md-field::part(content){cursor:text}:host([disabled=true]){pointer-events:none;cursor:default}\n"] }]
        }], ctorParameters: () => [], propDecorators: { selectedItemToTextFn: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGV4dC1maWVsZC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy93dHByb2dyYW1zL21hdGVyaWFsLWRlc2lnbi9zcmMvbGliL2NvbXBvbmVudHMvdGV4dC1maWVsZC90ZXh0LWZpZWxkLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3d0cHJvZ3JhbXMvbWF0ZXJpYWwtZGVzaWduL3NyYy9saWIvY29tcG9uZW50cy90ZXh0LWZpZWxkL3RleHQtZmllbGQuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCx1QkFBdUIsRUFDdkIsaUJBQWlCLEVBQ2pCLFVBQVUsRUFDVixLQUFLLEVBQ0wsU0FBUyxFQUVULFFBQVEsRUFDUixLQUFLLEdBQ04sTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFFBQVEsRUFBRSxZQUFZLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUNwRSxPQUFPLEVBQUUsV0FBVyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDaEUsT0FBTyxFQUFFLGFBQWEsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQy9FLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSx1Q0FBdUMsQ0FBQztBQUNyRSxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSwwQ0FBMEMsQ0FBQztBQUNqRixPQUFPLEVBQUUsY0FBYyxFQUFnQixNQUFNLDBCQUEwQixDQUFDO0FBQ3hFLE9BQU8sRUFBRSxvQ0FBb0MsRUFBRSxNQUFNLDZDQUE2QyxDQUFDO0FBQ25HLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUN2RCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUNyRSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0saUNBQWlDLENBQUM7QUFDaEUsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQy9DLE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLDhCQUE4QixDQUFDOzs7O0FBc0N2RSxNQUFNLE9BQU8sa0JBQW1CLFNBQVEsb0NBQTRDO0lBQ2hFLEtBQUssR0FBRyxLQUFLLEVBQVUsQ0FBQztJQUNqQyxPQUFPLEdBQUcsS0FBSyxDQUFlLFFBQVEsQ0FBQyxDQUFDO0lBQ3hDLElBQUksR0FBRyxLQUFLLENBQWdCLE1BQU0sQ0FBQyxDQUFDO0lBQ3BDLE1BQU0sR0FBRyxLQUFLLEVBQVUsQ0FBQztJQUN6QixNQUFNLEdBQUcsS0FBSyxFQUFVLENBQUM7SUFDekIsS0FBSyxHQUFHLEtBQUssRUFBVSxDQUFDO0lBQ3hCLGNBQWMsR0FBRyxLQUFLLEVBQVUsQ0FBQztJQUNqQyxTQUFTLEdBQUcsS0FBSyxFQUFVLENBQUM7SUFDNUIsV0FBVyxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUdwQyxvQkFBb0IsR0FBRyxDQUFDLEtBQWMsRUFBRSxFQUFFLENBQUMsS0FBSyxDQUFDO0lBRWhDLE1BQU0sR0FDckIsU0FBUyxDQUFxRCxPQUFPLENBQUMsQ0FBQztJQUV4RCxNQUFNLEdBQUcsU0FBUyxDQUFDLGNBQWMsQ0FBQyxDQUFDO0lBRTNDLFdBQVcsR0FBRyxRQUFRLENBQUMsR0FBRyxFQUFFLENBQ25DLElBQUksQ0FBQyxTQUFTLEVBQUUsSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFLEVBQUUsYUFBYTtRQUM5QyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxFQUFFLEVBQUUsTUFBTSxJQUFJLENBQUMsSUFBSSxJQUFJLENBQUMsU0FBUyxFQUFFLEVBQUU7UUFDcEQsQ0FBQyxDQUFDLFNBQVMsQ0FDZCxDQUFDO0lBRU8sU0FBUyxHQUFHLFFBQVEsQ0FDM0IsYUFBYSxDQUFDO1FBQ1osT0FBTyxFQUFFLEtBQUssQ0FDWixZQUFZLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FDNUIsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLGFBQWEsQ0FBQyxFQUNqQyxTQUFTLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUNkLFNBQVMsQ0FBQyxDQUFFLENBQUMsYUFBYSxFQUFFLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FDM0QsQ0FDRixFQUNELFlBQVksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUM1QixNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsYUFBYSxDQUFDLEVBQ2pDLFNBQVMsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQ2QsU0FBUyxDQUFDLENBQUUsQ0FBQyxhQUFhLEVBQUUsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUMzRCxDQUNGLENBQ0Y7UUFDRCxRQUFRLEVBQUUsWUFBWSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7S0FDekQsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQzdDLENBQUM7SUFFRjtRQUNFLEtBQUssRUFBRSxDQUFDO1FBQ1IsWUFBWSxDQUFDLHFCQUFxQixFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNqRCxJQUFJLENBQUMsUUFBUSxDQUFDLGlCQUFpQixFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUU7WUFDckMsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDckIsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEtBQUssRUFBRSxLQUFLLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDO1FBQzdDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELGNBQWM7UUFDWixJQUFJLENBQUMsTUFBTSxFQUFFLEVBQUUsYUFBYSxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQ3ZDLENBQUM7SUFFRCxPQUFPLENBQUMsS0FBWTtRQUNsQixJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUUsS0FBSyxXQUFXLEVBQUUsQ0FBQztZQUNoQyxNQUFNLE1BQU0sR0FBRyxLQUFLLENBQUMsTUFBNkIsQ0FBQztZQUNuRCxNQUFNLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7WUFDN0IsTUFBTSxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUM7UUFDbkQsQ0FBQztRQUNELElBQUksSUFBSSxDQUFDLFdBQVcsRUFBRSxFQUFFLENBQUM7WUFDdkIsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsRUFBRSxPQUFPLEVBQUUsRUFBRSxJQUFJLEVBQUUsRUFBRSxDQUFDO2dCQUN0QyxJQUFJLENBQUMsTUFBTSxFQUFHLENBQUMsT0FBTyxFQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUMzQyxDQUFDO1FBQ0gsQ0FBQztJQUNILENBQUM7SUFFRCxXQUFXLENBQUMsS0FBWTtRQUN0QixNQUFNLElBQUksR0FBRyx1QkFBdUIsQ0FBQyxHQUFHLENBQW9CLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUMxRSxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsSUFBSyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQztJQUMzRCxDQUFDO3VHQTFFVSxrQkFBa0I7MkZBQWxCLGtCQUFrQix5c0RBUmxCO1lBQ1Q7Z0JBQ0UsT0FBTyxFQUFFLGlCQUFpQjtnQkFDMUIsS0FBSyxFQUFFLElBQUk7Z0JBQ1gsV0FBVyxFQUFFLFVBQVUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQzthQUNsRDtTQUNGLG9LQW1CbUMsY0FBYyxrSkM3RXBELHlrQ0F5QlcsdWtDRGdCUCxjQUFjLHNWQUNkLFdBQVcsK21CQUNYLGFBQWEsb0RBQ2IsYUFBYSwwRUFDYixZQUFZOzsyRkFlSCxrQkFBa0I7a0JBM0I5QixTQUFTOytCQUNFLGVBQWUsY0FHYixJQUFJLG1CQUNDLHVCQUF1QixDQUFDLE1BQU0saUJBQ2hDLGlCQUFpQixDQUFDLFNBQVMsV0FDakM7d0JBQ1AsY0FBYzt3QkFDZCxXQUFXO3dCQUNYLGFBQWE7d0JBQ2IsYUFBYTt3QkFDYixZQUFZO3FCQUNiLFFBQ0s7d0JBQ0osaUJBQWlCLEVBQUUsb0JBQW9CO3dCQUN2QyxRQUFRLEVBQUUsR0FBRztxQkFDZCxrQkFDZSxDQUFDLHFCQUFxQixDQUFDLGFBQzVCO3dCQUNUOzRCQUNFLE9BQU8sRUFBRSxpQkFBaUI7NEJBQzFCLEtBQUssRUFBRSxJQUFJOzRCQUNYLFdBQVcsRUFBRSxVQUFVLENBQUMsR0FBRyxFQUFFLG1CQUFtQixDQUFDO3lCQUNsRDtxQkFDRjt3REFjRCxvQkFBb0I7c0JBRG5CLEtBQUsiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDb21wb25lbnQsXG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBWaWV3RW5jYXBzdWxhdGlvbixcbiAgZm9yd2FyZFJlZixcbiAgbW9kZWwsXG4gIHZpZXdDaGlsZCxcbiAgRWxlbWVudFJlZixcbiAgY29tcHV0ZWQsXG4gIElucHV0LFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IHRvU2lnbmFsLCB0b09ic2VydmFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlL3J4anMtaW50ZXJvcCc7XG5pbXBvcnQgeyBGb3Jtc01vZHVsZSwgTkdfVkFMVUVfQUNDRVNTT1IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBjb21iaW5lTGF0ZXN0LCBtZXJnZSwgZmlsdGVyLCBzd2l0Y2hNYXAsIGZyb21FdmVudCwgbWFwIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBhdHRhY2hUYXJnZXQgfSBmcm9tICcuLi8uLi9kaXJlY3RpdmVzL2F0dGFjaGFibGUuZGlyZWN0aXZlJztcbmltcG9ydCB7IEZvcndhcmRGb2N1c0RpcmVjdGl2ZSB9IGZyb20gJy4uLy4uL2RpcmVjdGl2ZXMvZm9yd2FyZC1mb2N1cy5kaXJlY3RpdmUnO1xuaW1wb3J0IHsgRmllbGRDb21wb25lbnQsIEZpZWxkVmFyaWFudCB9IGZyb20gJy4uL2ZpZWxkL2ZpZWxkLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBNYXRlcmlhbERlc2lnblZhbHVlQWNjZXNzb3JDb21wb25lbnQgfSBmcm9tICcuLi9tYXRlcmlhbC1kZXNpZ24tdmFsdWUtYWNjZXNzb3IuY29tcG9uZW50JztcbmltcG9ydCB7IExpc3RDb21wb25lbnQgfSBmcm9tICcuLi9saXN0L2xpc3QuY29tcG9uZW50JztcbmltcG9ydCB7IExpc3RJdGVtQ29tcG9uZW50IH0gZnJvbSAnLi4vbGlzdC1pdGVtL2xpc3QtaXRlbS5jb21wb25lbnQnO1xuaW1wb3J0IHsgU2xvdERpcmVjdGl2ZSB9IGZyb20gJy4uLy4uL2RpcmVjdGl2ZXMvc2xvdC5kaXJlY3RpdmUnO1xuaW1wb3J0IHsgQ29tbW9uTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IE1hdGVyaWFsRGVzaWduQ29tcG9uZW50IH0gZnJvbSAnLi4vbWF0ZXJpYWwtZGVzaWduLmNvbXBvbmVudCc7XG5cbmV4cG9ydCB0eXBlIFRleHRGaWVsZFR5cGUgPVxuICB8ICd0ZXh0J1xuICB8ICdwYXNzd29yZCdcbiAgfCAnZW1haWwnXG4gIHwgJ251bWJlcidcbiAgfCAndGVsJ1xuICB8ICd1cmwnXG4gIHwgJ3RleHQtYXJlYSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ21kLXRleHQtZmllbGQnLFxuICB0ZW1wbGF0ZVVybDogJy4vdGV4dC1maWVsZC5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsOiAnLi90ZXh0LWZpZWxkLmNvbXBvbmVudC5zY3NzJyxcbiAgc3RhbmRhbG9uZTogdHJ1ZSxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG4gIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLlNoYWRvd0RvbSxcbiAgaW1wb3J0czogW1xuICAgIEZpZWxkQ29tcG9uZW50LFxuICAgIEZvcm1zTW9kdWxlLFxuICAgIExpc3RDb21wb25lbnQsXG4gICAgU2xvdERpcmVjdGl2ZSxcbiAgICBDb21tb25Nb2R1bGUsXG4gIF0sXG4gIGhvc3Q6IHtcbiAgICAnW2F0dHIuZGlzYWJsZWRdJzogJ2Rpc2FibGVkKCkgfHwgbnVsbCcsXG4gICAgdGFiaW5kZXg6ICcwJyxcbiAgfSxcbiAgaG9zdERpcmVjdGl2ZXM6IFtGb3J3YXJkRm9jdXNEaXJlY3RpdmVdLFxuICBwcm92aWRlcnM6IFtcbiAgICB7XG4gICAgICBwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUixcbiAgICAgIG11bHRpOiB0cnVlLFxuICAgICAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gVGV4dEZpZWxkQ29tcG9uZW50KSxcbiAgICB9LFxuICBdLFxufSlcbmV4cG9ydCBjbGFzcyBUZXh0RmllbGRDb21wb25lbnQgZXh0ZW5kcyBNYXRlcmlhbERlc2lnblZhbHVlQWNjZXNzb3JDb21wb25lbnQ8c3RyaW5nPiB7XG4gIG92ZXJyaWRlIHJlYWRvbmx5IHZhbHVlID0gbW9kZWw8c3RyaW5nPigpO1xuICByZWFkb25seSB2YXJpYW50ID0gbW9kZWw8RmllbGRWYXJpYW50PignZmlsbGVkJyk7XG4gIHJlYWRvbmx5IHR5cGUgPSBtb2RlbDxUZXh0RmllbGRUeXBlPigndGV4dCcpO1xuICByZWFkb25seSBwcmVmaXggPSBtb2RlbDxzdHJpbmc+KCk7XG4gIHJlYWRvbmx5IHN1ZmZpeCA9IG1vZGVsPHN0cmluZz4oKTtcbiAgcmVhZG9ubHkgbGFiZWwgPSBtb2RlbDxzdHJpbmc+KCk7XG4gIHJlYWRvbmx5IHN1cHBvcnRpbmdUZXh0ID0gbW9kZWw8c3RyaW5nPigpO1xuICByZWFkb25seSBtYXhMZW5ndGggPSBtb2RlbDxudW1iZXI+KCk7XG4gIHJlYWRvbmx5IGhhc0Ryb3Bkb3duID0gbW9kZWwoZmFsc2UpO1xuXG4gIEBJbnB1dCgpXG4gIHNlbGVjdGVkSXRlbVRvVGV4dEZuID0gKHZhbHVlPzogc3RyaW5nKSA9PiB2YWx1ZTtcblxuICBwcml2YXRlIHJlYWRvbmx5IF9pbnB1dCA9XG4gICAgdmlld0NoaWxkPEVsZW1lbnRSZWY8SFRNTElucHV0RWxlbWVudCB8IEhUTUxUZXh0QXJlYUVsZW1lbnQ+PignaW5wdXQnKTtcblxuICBwcml2YXRlIHJlYWRvbmx5IF9maWVsZCA9IHZpZXdDaGlsZChGaWVsZENvbXBvbmVudCk7XG5cbiAgcmVhZG9ubHkgY291bnRlclRleHQgPSBjb21wdXRlZCgoKSA9PlxuICAgIHRoaXMubWF4TGVuZ3RoKCkgJiYgdGhpcy5faW5wdXQoKT8ubmF0aXZlRWxlbWVudFxuICAgICAgPyBgJHt0aGlzLnZhbHVlKCk/Lmxlbmd0aCA/PyAwfS8ke3RoaXMubWF4TGVuZ3RoKCl9YFxuICAgICAgOiB1bmRlZmluZWRcbiAgKTtcblxuICByZWFkb25seSBwb3B1bGF0ZWQgPSB0b1NpZ25hbChcbiAgICBjb21iaW5lTGF0ZXN0KHtcbiAgICAgIGZvY3VzZWQ6IG1lcmdlKFxuICAgICAgICB0b09ic2VydmFibGUodGhpcy5faW5wdXQpLnBpcGUoXG4gICAgICAgICAgZmlsdGVyKCh4KSA9PiAhIXg/Lm5hdGl2ZUVsZW1lbnQpLFxuICAgICAgICAgIHN3aXRjaE1hcCgoeCkgPT5cbiAgICAgICAgICAgIGZyb21FdmVudCh4IS5uYXRpdmVFbGVtZW50LCAnZm9jdXMnKS5waXBlKG1hcCgoKSA9PiB0cnVlKSlcbiAgICAgICAgICApXG4gICAgICAgICksXG4gICAgICAgIHRvT2JzZXJ2YWJsZSh0aGlzLl9pbnB1dCkucGlwZShcbiAgICAgICAgICBmaWx0ZXIoKHgpID0+ICEheD8ubmF0aXZlRWxlbWVudCksXG4gICAgICAgICAgc3dpdGNoTWFwKCh4KSA9PlxuICAgICAgICAgICAgZnJvbUV2ZW50KHghLm5hdGl2ZUVsZW1lbnQsICdibHVyJykucGlwZShtYXAoKCkgPT4gZmFsc2UpKVxuICAgICAgICAgIClcbiAgICAgICAgKVxuICAgICAgKSxcbiAgICAgIGhhc1ZhbHVlOiB0b09ic2VydmFibGUodGhpcy52YWx1ZSkucGlwZShtYXAoKHgpID0+ICEheCkpLFxuICAgIH0pLnBpcGUobWFwKCh4KSA9PiB4LmZvY3VzZWQgfHwgeC5oYXNWYWx1ZSkpXG4gICk7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoKTtcbiAgICBhdHRhY2hUYXJnZXQoRm9yd2FyZEZvY3VzRGlyZWN0aXZlLCB0aGlzLl9pbnB1dCk7XG4gICAgdGhpcy5zZXRTbG90cyhMaXN0SXRlbUNvbXBvbmVudCwgKHgpID0+IHtcbiAgICAgIHgudHlwZS5zZXQoJ2J1dHRvbicpO1xuICAgICAgeC5zZWxlY3RlZC5zZXQoeC52YWx1ZSgpID09PSB0aGlzLnZhbHVlKCkpO1xuICAgIH0pO1xuICB9XG5cbiAgb25Db250ZW50Q2xpY2soKSB7XG4gICAgdGhpcy5faW5wdXQoKT8ubmF0aXZlRWxlbWVudC5mb2N1cygpO1xuICB9XG5cbiAgb25JbnB1dChldmVudDogRXZlbnQpIHtcbiAgICBpZiAodGhpcy50eXBlKCkgPT09ICd0ZXh0LWFyZWEnKSB7XG4gICAgICBjb25zdCB0YXJnZXQgPSBldmVudC50YXJnZXQgYXMgSFRNTFRleHRBcmVhRWxlbWVudDtcbiAgICAgIHRhcmdldC5zdHlsZS5oZWlnaHQgPSAnYXV0byc7XG4gICAgICB0YXJnZXQuc3R5bGUuaGVpZ2h0ID0gdGFyZ2V0LnNjcm9sbEhlaWdodCArICdweCc7XG4gICAgfVxuICAgIGlmICh0aGlzLmhhc0Ryb3Bkb3duKCkpIHtcbiAgICAgIGlmICghdGhpcy5fZmllbGQoKT8ucG9wb3ZlcigpPy5vcGVuKCkpIHtcbiAgICAgICAgdGhpcy5fZmllbGQoKSEucG9wb3ZlcigpIS5vcGVuLnNldCh0cnVlKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBvbkl0ZW1DbGljayhldmVudDogRXZlbnQpIHtcbiAgICBjb25zdCBpdGVtID0gTWF0ZXJpYWxEZXNpZ25Db21wb25lbnQuZ2V0PExpc3RJdGVtQ29tcG9uZW50PihldmVudC50YXJnZXQpO1xuICAgIHRoaXMudmFsdWUuc2V0KHRoaXMuc2VsZWN0ZWRJdGVtVG9UZXh0Rm4oaXRlbSEudmFsdWUoKSkpO1xuICB9XG59XG4iLCI8bWQtZmllbGQgW3ZhcmlhbnRdPVwidmFyaWFudCgpXCIgW3BvcHVsYXRlZF09XCIhIXBvcHVsYXRlZCgpXCIgW2Vycm9yVGV4dF09XCJlcnJvclRleHQoKVwiIFtsYWJlbF09XCJsYWJlbCgpXCJcbiAgKGNvbnRlbnRDbGljayk9XCJvbkNvbnRlbnRDbGljaygpXCIgW2Rpc2FibGVkXT1cImRpc2FibGVkKClcIiBwb3BvdmVyVHJpZ2dlcj1cIm1hbnVhbFwiIFttYXhQb3BvdmVySGVpZ2h0XT1cIjMwMFwiPlxuICA8c2xvdCBuYW1lPVwibGVhZGluZ1wiIHNsb3Q9XCJsZWFkaW5nXCI+PC9zbG90PlxuXG4gIDxzbG90IG5hbWU9XCJwcmVmaXhcIiBzbG90PVwicHJlZml4XCI+PC9zbG90PlxuICA8c2xvdCBuYW1lPVwic3VmZml4XCIgc2xvdD1cInN1ZmZpeFwiPjwvc2xvdD5cbiAgPHNsb3QgbmFtZT1cInN1cHBvcnRpbmctdGV4dFwiIHNsb3Q9XCJzdXBwb3J0aW5nLXRleHRcIj48L3Nsb3Q+XG5cbiAgQGlmIChjb3VudGVyVGV4dCgpKSB7XG4gIDxzcGFuIHNsb3Q9XCJjb3VudGVyXCI+e3sgY291bnRlclRleHQoKSB9fTwvc3Bhbj5cbiAgfVxuXG4gIEBpZiAodHlwZSgpID09PSAndGV4dC1hcmVhJykge1xuICA8dGV4dGFyZWEgI2lucHV0IFtuZ01vZGVsXT1cInZhbHVlKClcIiAobmdNb2RlbENoYW5nZSk9XCJ2YWx1ZS5zZXQoJGV2ZW50KVwiIHJvd3M9XCIxXCIgKGlucHV0KT1cIm9uSW5wdXQoJGV2ZW50KVwiXG4gICAgW2Rpc2FibGVkXT1cImRpc2FibGVkKClcIj48L3RleHRhcmVhPlxuICB9IEBlbHNlIHtcbiAgPGlucHV0ICNpbnB1dCBbbmdNb2RlbF09XCJ2YWx1ZSgpXCIgKG5nTW9kZWxDaGFuZ2UpPVwidmFsdWUuc2V0KCRldmVudClcIiBbdHlwZV09XCJ0eXBlKClcIiBbZGlzYWJsZWRdPVwiZGlzYWJsZWQoKVwiXG4gICAgKGlucHV0KT1cIm9uSW5wdXQoJGV2ZW50KVwiPlxuICB9XG4gIDxzbG90IG5hbWU9XCJ0cmFpbGluZ1wiIHNsb3Q9XCJ0cmFpbGluZ1wiPjwvc2xvdD5cbiAgQGlmIChoYXNEcm9wZG93bigpKSB7XG4gIDxtZC1saXN0IHNsb3Q9XCJwb3BvdmVyXCI+XG4gICAgPHNsb3QgKGNsaWNrKT1cIm9uSXRlbUNsaWNrKCRldmVudClcIj48L3Nsb3Q+XG4gIDwvbWQtbGlzdD5cbiAgfVxuPC9tZC1maWVsZD4iXX0=