import { ChangeDetectionStrategy, Component, inject, model, output, viewChild, ViewEncapsulation, } from '@angular/core';
import { MaterialDesignComponent } from '../material-design.component';
import { DOCUMENT, isPlatformBrowser } from '@angular/common';
import { toObservable, toSignal } from '@angular/core/rxjs-interop';
import { skip, tap } from 'rxjs';
import { openClose } from '../../common/rxjs/open-close';
import { ElevationComponent } from '../elevation/elevation.component';
import { SlotDirective } from '../../directives/slot.directive';
import { ButtonComponent } from '../button/button.component';
import * as i0 from "@angular/core";
export class DialogComponent extends MaterialDesignComponent {
    returnValue = model();
    open = model(false);
    cancel = output();
    _dialog = viewChild('dialog');
    iconSlot = this.slotDirective('icon');
    headlineSlot = this.slotDirective('headline');
    supportingtext = this.slotDirective('supporting-text');
    actionSlot = this.slotDirective('action');
    bodySlot = this.slotDirective();
    _document = inject(DOCUMENT);
    _openClose$ = openClose(this.open, 'long3', 'long2');
    state = toSignal(this._openClose$, {
        initialValue: 'closed',
    });
    stateChange = output();
    constructor() {
        super();
        toObservable(this.state)
            .pipe(tap((x) => this.stateChange.emit(x)), skip(1), tap((state) => {
            if (state === 'opening') {
                this._document.body.style.overflow = 'hidden';
                if (isPlatformBrowser(this.platformId)) {
                    this._dialog()?.nativeElement.showModal();
                }
            }
            if (state === 'closed') {
                this._document.body.style.overflow = '';
                if (isPlatformBrowser(this.platformId)) {
                    this._dialog()?.nativeElement.close();
                }
            }
        }))
            .subscribe();
        this.setSlots(ButtonComponent, (component) => {
            component.hostElement.slot = 'action';
            component.variant.set('text');
        });
    }
    _nextClickIsFromContent = false;
    _escapePressedWithoutCancel = false;
    onDialogCancel(event) {
        event.preventDefault();
        this._escapePressedWithoutCancel = false;
        this.open.set(false);
    }
    onDialogClose() {
        if (!this._escapePressedWithoutCancel) {
            this.cancel.emit();
        }
        this._escapePressedWithoutCancel = false;
        this._dialog()?.nativeElement?.dispatchEvent(new Event('cancel', { cancelable: true }));
    }
    onDialogKeyDown(event) {
        if (event.key !== 'Escape') {
            return;
        }
        this._escapePressedWithoutCancel = true;
        setTimeout(() => (this._escapePressedWithoutCancel = false));
    }
    onDialogClick() {
        if (this._nextClickIsFromContent) {
            this._nextClickIsFromContent = false;
            return;
        }
        this.cancel.emit();
        this.open.set(false);
    }
    onContainerContentClick() {
        this._nextClickIsFromContent = true;
    }
    static ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.9", ngImport: i0, type: DialogComponent, deps: [], target: i0.ɵɵFactoryTarget.Component });
    static ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.2.0", version: "18.2.9", type: DialogComponent, isStandalone: true, selector: "md-dialog", inputs: { returnValue: { classPropertyName: "returnValue", publicName: "returnValue", isSignal: true, isRequired: false, transformFunction: null }, open: { classPropertyName: "open", publicName: "open", isSignal: true, isRequired: false, transformFunction: null } }, outputs: { returnValue: "returnValueChange", open: "openChange", cancel: "cancel", stateChange: "stateChange" }, host: { properties: { "attr.icon": "iconSlot()?.any() || null", "attr.headline": "headlineSlot()?.any() || null", "attr.supportingText": "supportingtext()?.any() || null", "attr.actions": "actionSlot()?.any() || null", "attr.body": "bodySlot()?.any() || null", "attr.state": "state()" } }, viewQueries: [{ propertyName: "_dialog", first: true, predicate: ["dialog"], descendants: true, isSignal: true }], usesInheritance: true, ngImport: i0, template: "<div part=\"scrim\" class=\"scrim\"></div>\n<dialog part=\"dialog\" #dialog [returnValue]=\"returnValue() || null\" (cancel)=\"onDialogCancel($event)\"\n  (click)=\"onDialogClick()\" (close)=\"onDialogClose()\" (keydown)=\"onDialogKeyDown($event)\">\n  <div part=\"container\" class=\"container\">\n    <md-elevation part=\"elevation\" [level]=\"3\" />\n    <div part=\"container-content\" class=\"container-content\" (click)=\"onContainerContentClick()\">\n      <div part=\"header\" class=\"header\">\n        <div part=\"icon\" class=\"icon\">\n          <slot name=\"icon\"></slot>\n        </div>\n        <div part=\"headline\" class=\"headline\">\n          <slot name=\"headline\"></slot>\n        </div>\n        <div part=\"supporting-text\" class=\"supporting-text\">\n          <slot #supportingTextSlot name=\"supporting-text\"></slot>\n        </div>\n      </div>\n      <div class=\"scroller\">\n        <div class=\"content\">\n          <slot></slot>\n        </div>\n      </div>\n      <div part=\"actions\" #actions class=\"actions\">\n        <slot name=\"action\"></slot>\n      </div>\n    </div>\n  </div>\n</dialog>", styles: [":host{--_motion-easing: var(--md-sys-motion-easing-emphasized-decelerate);--_motion-duration: var(--md-sys-motion-duration-long-1);max-height:min(560px,100% - 48px);max-width:min(560px,100% - 48px);min-height:140px;min-width:280px;display:contents;margin:auto;position:fixed;height:fit-content;width:fit-content}:host dialog{background:transparent;border:none;border-radius:inherit;flex-direction:column;height:inherit;margin:inherit;max-height:inherit;max-width:inherit;min-height:inherit;min-width:inherit;outline:none;overflow:visible;padding:0;width:inherit;opacity:0;transform:translateY(-200px);color:var(--md-sys-color-surface-on);transition-property:opacity,transform;transition-timing-function:var(--_motion-easing);transition-duration:var(--_motion-duration)}:host dialog[open]{display:inline-flex}:host ::backdrop{background:none}:host .container{position:relative;border-radius:inherit;display:inline-flex;border-radius:var(--md-sys-shape-extra-large);flex-direction:column;background-color:var(--md-sys-color-surface-container);max-height:670px}:host .container-content{position:relative;border-radius:inherit;display:inline-flex;border-radius:var(--md-sys-shape-extra-large);flex-direction:column;gap:24px;padding:24px;transform-origin:top;overflow:hidden;height:auto;opacity:0;transition-property:opacity;transition-timing-function:var(--_motion-easing);transition-duration:var(--_motion-duration);transition-delay:.1s}:host .scrim{visibility:hidden;inset:0;position:fixed;z-index:-1;background:var(--md-sys-color-scrim);opacity:0;transition-property:opacity,visibility;transition-timing-function:var(--_motion-easing);transition-duration:var(--_motion-duration)}:host .header{display:none;flex-direction:column;width:100%;gap:16px}:host .actions{display:none;gap:8px;justify-content:flex-end}:host .scroller{display:none;overflow-y:hidden;flex-direction:column}:host .content{height:min-content;position:relative}:host .headline{font-size:var(--md-sys-typescale-headline-small-size);font-weight:var(--md-sys-typescale-headline-small-weight);font-family:var(--md-sys-typescale-headline-small-font);color:var(--md-sys-color-surface-on);display:none;flex-direction:row;align-items:flex-start;gap:16px}:host .supporting-text{display:none;font-size:var(--md-sys-typescale-body-medium-size);font-weight:var(--md-sys-typescale-body-medium-weight);font-family:var(--md-sys-typescale-body-medium-font);color:var(--md-sys-color-surface-variant-on)}:host .icon{display:none;color:var(--md-sys-color-secondary)}:host .icon ::slotted(md-icon){--md-sys-icon-size: 24}:host([state=opening]) dialog,:host([state=opened]) dialog{opacity:1;transform:translateY(0)}:host([state=opening]) .scrim,:host([state=opened]) .scrim{opacity:.32}:host([state=opening]) .container-content,:host([state=opened]) .container-content{opacity:1}:host([state=opened]) .scroller{overflow-y:auto}:host(:not([state=closed])) .scrim{visibility:visible;z-index:var(--md-sys-z-index-scrim)}:host([state=closing]){--_motion-easing: var(--md-sys-motion-easing-emphasized-accelerate);--_motion-duration: var(--md-sys-motion-duration-short-4)}:host([state=closing]) dialog{opacity:0;transform:translateY(-200px)}:host([state=closing]) .scrim{opacity:0}:host([state=closing]) .container-content{opacity:0}:host([body=true]) .scroller{display:inline-flex}:host([header=true]) .header{display:inline-flex}:host([actions=true]) .actions{margin-top:auto;display:inline-flex}:host([icon=true]) .header,:host([headline=true]) .header,:host([supportingText=true]) .header{display:inline-flex}:host([icon=true]) .icon{display:inline-flex}:host([icon=true]) .headline{flex-direction:column}:host([icon=true]) .headline,:host([icon=true]) .header{align-items:center}:host([headline=true]) .headline{display:inline-flex}:host([supportingText=true]) .supporting-text{display:inline-flex}\n"], dependencies: [{ kind: "component", type: ElevationComponent, selector: "md-elevation", inputs: ["level", "hoverable", "interactive", "dragging"], outputs: ["levelChange", "hoverableChange", "interactiveChange", "draggingChange"] }, { kind: "directive", type: SlotDirective, selector: "slot", inputs: ["name", "slot"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush, encapsulation: i0.ViewEncapsulation.ShadowDom });
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.9", ngImport: i0, type: DialogComponent, decorators: [{
            type: Component,
            args: [{ selector: 'md-dialog', standalone: true, changeDetection: ChangeDetectionStrategy.OnPush, encapsulation: ViewEncapsulation.ShadowDom, imports: [ElevationComponent, SlotDirective], host: {
                        '[attr.icon]': `iconSlot()?.any() || null`,
                        '[attr.headline]': `headlineSlot()?.any() || null`,
                        '[attr.supportingText]': `supportingtext()?.any() || null`,
                        '[attr.actions]': `actionSlot()?.any() || null`,
                        '[attr.body]': `bodySlot()?.any() || null`,
                        '[attr.state]': 'state()',
                    }, template: "<div part=\"scrim\" class=\"scrim\"></div>\n<dialog part=\"dialog\" #dialog [returnValue]=\"returnValue() || null\" (cancel)=\"onDialogCancel($event)\"\n  (click)=\"onDialogClick()\" (close)=\"onDialogClose()\" (keydown)=\"onDialogKeyDown($event)\">\n  <div part=\"container\" class=\"container\">\n    <md-elevation part=\"elevation\" [level]=\"3\" />\n    <div part=\"container-content\" class=\"container-content\" (click)=\"onContainerContentClick()\">\n      <div part=\"header\" class=\"header\">\n        <div part=\"icon\" class=\"icon\">\n          <slot name=\"icon\"></slot>\n        </div>\n        <div part=\"headline\" class=\"headline\">\n          <slot name=\"headline\"></slot>\n        </div>\n        <div part=\"supporting-text\" class=\"supporting-text\">\n          <slot #supportingTextSlot name=\"supporting-text\"></slot>\n        </div>\n      </div>\n      <div class=\"scroller\">\n        <div class=\"content\">\n          <slot></slot>\n        </div>\n      </div>\n      <div part=\"actions\" #actions class=\"actions\">\n        <slot name=\"action\"></slot>\n      </div>\n    </div>\n  </div>\n</dialog>", styles: [":host{--_motion-easing: var(--md-sys-motion-easing-emphasized-decelerate);--_motion-duration: var(--md-sys-motion-duration-long-1);max-height:min(560px,100% - 48px);max-width:min(560px,100% - 48px);min-height:140px;min-width:280px;display:contents;margin:auto;position:fixed;height:fit-content;width:fit-content}:host dialog{background:transparent;border:none;border-radius:inherit;flex-direction:column;height:inherit;margin:inherit;max-height:inherit;max-width:inherit;min-height:inherit;min-width:inherit;outline:none;overflow:visible;padding:0;width:inherit;opacity:0;transform:translateY(-200px);color:var(--md-sys-color-surface-on);transition-property:opacity,transform;transition-timing-function:var(--_motion-easing);transition-duration:var(--_motion-duration)}:host dialog[open]{display:inline-flex}:host ::backdrop{background:none}:host .container{position:relative;border-radius:inherit;display:inline-flex;border-radius:var(--md-sys-shape-extra-large);flex-direction:column;background-color:var(--md-sys-color-surface-container);max-height:670px}:host .container-content{position:relative;border-radius:inherit;display:inline-flex;border-radius:var(--md-sys-shape-extra-large);flex-direction:column;gap:24px;padding:24px;transform-origin:top;overflow:hidden;height:auto;opacity:0;transition-property:opacity;transition-timing-function:var(--_motion-easing);transition-duration:var(--_motion-duration);transition-delay:.1s}:host .scrim{visibility:hidden;inset:0;position:fixed;z-index:-1;background:var(--md-sys-color-scrim);opacity:0;transition-property:opacity,visibility;transition-timing-function:var(--_motion-easing);transition-duration:var(--_motion-duration)}:host .header{display:none;flex-direction:column;width:100%;gap:16px}:host .actions{display:none;gap:8px;justify-content:flex-end}:host .scroller{display:none;overflow-y:hidden;flex-direction:column}:host .content{height:min-content;position:relative}:host .headline{font-size:var(--md-sys-typescale-headline-small-size);font-weight:var(--md-sys-typescale-headline-small-weight);font-family:var(--md-sys-typescale-headline-small-font);color:var(--md-sys-color-surface-on);display:none;flex-direction:row;align-items:flex-start;gap:16px}:host .supporting-text{display:none;font-size:var(--md-sys-typescale-body-medium-size);font-weight:var(--md-sys-typescale-body-medium-weight);font-family:var(--md-sys-typescale-body-medium-font);color:var(--md-sys-color-surface-variant-on)}:host .icon{display:none;color:var(--md-sys-color-secondary)}:host .icon ::slotted(md-icon){--md-sys-icon-size: 24}:host([state=opening]) dialog,:host([state=opened]) dialog{opacity:1;transform:translateY(0)}:host([state=opening]) .scrim,:host([state=opened]) .scrim{opacity:.32}:host([state=opening]) .container-content,:host([state=opened]) .container-content{opacity:1}:host([state=opened]) .scroller{overflow-y:auto}:host(:not([state=closed])) .scrim{visibility:visible;z-index:var(--md-sys-z-index-scrim)}:host([state=closing]){--_motion-easing: var(--md-sys-motion-easing-emphasized-accelerate);--_motion-duration: var(--md-sys-motion-duration-short-4)}:host([state=closing]) dialog{opacity:0;transform:translateY(-200px)}:host([state=closing]) .scrim{opacity:0}:host([state=closing]) .container-content{opacity:0}:host([body=true]) .scroller{display:inline-flex}:host([header=true]) .header{display:inline-flex}:host([actions=true]) .actions{margin-top:auto;display:inline-flex}:host([icon=true]) .header,:host([headline=true]) .header,:host([supportingText=true]) .header{display:inline-flex}:host([icon=true]) .icon{display:inline-flex}:host([icon=true]) .headline{flex-direction:column}:host([icon=true]) .headline,:host([icon=true]) .header{align-items:center}:host([headline=true]) .headline{display:inline-flex}:host([supportingText=true]) .supporting-text{display:inline-flex}\n"] }]
        }], ctorParameters: () => [] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGlhbG9nLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3d0cHJvZ3JhbXMvbWF0ZXJpYWwtZGVzaWduL3NyYy9saWIvY29tcG9uZW50cy9kaWFsb2cvZGlhbG9nLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3d0cHJvZ3JhbXMvbWF0ZXJpYWwtZGVzaWduL3NyYy9saWIvY29tcG9uZW50cy9kaWFsb2cvZGlhbG9nLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCx1QkFBdUIsRUFDdkIsU0FBUyxFQUVULE1BQU0sRUFDTixLQUFLLEVBQ0wsTUFBTSxFQUNOLFNBQVMsRUFDVCxpQkFBaUIsR0FDbEIsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDdkUsT0FBTyxFQUFFLFFBQVEsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzlELE9BQU8sRUFBRSxZQUFZLEVBQUUsUUFBUSxFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDcEUsT0FBTyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDakMsT0FBTyxFQUFFLFNBQVMsRUFBa0IsTUFBTSw4QkFBOEIsQ0FBQztBQUN6RSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUN0RSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0saUNBQWlDLENBQUM7QUFDaEUsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLDRCQUE0QixDQUFDOztBQW1CN0QsTUFBTSxPQUFPLGVBQWdCLFNBQVEsdUJBQXVCO0lBQ2pELFdBQVcsR0FBRyxLQUFLLEVBQVUsQ0FBQztJQUM5QixJQUFJLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lB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RUFBRSw2QkFBNkI7d0JBQy9DLGFBQWEsRUFBRSwyQkFBMkI7d0JBQzFDLGNBQWMsRUFBRSxTQUFTO3FCQUMxQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDb21wb25lbnQsXG4gIEVsZW1lbnRSZWYsXG4gIGluamVjdCxcbiAgbW9kZWwsXG4gIG91dHB1dCxcbiAgdmlld0NoaWxkLFxuICBWaWV3RW5jYXBzdWxhdGlvbixcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBNYXRlcmlhbERlc2lnbkNvbXBvbmVudCB9IGZyb20gJy4uL21hdGVyaWFsLWRlc2lnbi5jb21wb25lbnQnO1xuaW1wb3J0IHsgRE9DVU1FTlQsIGlzUGxhdGZvcm1Ccm93c2VyIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IHRvT2JzZXJ2YWJsZSwgdG9TaWduYWwgfSBmcm9tICdAYW5ndWxhci9jb3JlL3J4anMtaW50ZXJvcCc7XG5pbXBvcnQgeyBza2lwLCB0YXAgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IG9wZW5DbG9zZSwgT3BlbkNsb3NlU3RhdGUgfSBmcm9tICcuLi8uLi9jb21tb24vcnhqcy9vcGVuLWNsb3NlJztcbmltcG9ydCB7IEVsZXZhdGlvbkNvbXBvbmVudCB9IGZyb20gJy4uL2VsZXZhdGlvbi9lbGV2YXRpb24uY29tcG9uZW50JztcbmltcG9ydCB7IFNsb3REaXJlY3RpdmUgfSBmcm9tICcuLi8uLi9kaXJlY3RpdmVzL3Nsb3QuZGlyZWN0aXZlJztcbmltcG9ydCB7IEJ1dHRvbkNvbXBvbmVudCB9IGZyb20gJy4uL2J1dHRvbi9idXR0b24uY29tcG9uZW50JztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnbWQtZGlhbG9nJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2RpYWxvZy5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsOiAnLi9kaWFsb2cuY29tcG9uZW50LnNjc3MnLFxuICBzdGFuZGFsb25lOiB0cnVlLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbiAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uU2hhZG93RG9tLFxuICBpbXBvcnRzOiBbRWxldmF0aW9uQ29tcG9uZW50LCBTbG90RGlyZWN0aXZlXSxcbiAgaG9zdDoge1xuICAgICdbYXR0ci5pY29uXSc6IGBpY29uU2xvdCgpPy5hbnkoKSB8fCBudWxsYCxcbiAgICAnW2F0dHIuaGVhZGxpbmVdJzogYGhlYWRsaW5lU2xvdCgpPy5hbnkoKSB8fCBudWxsYCxcbiAgICAnW2F0dHIuc3VwcG9ydGluZ1RleHRdJzogYHN1cHBvcnRpbmd0ZXh0KCk/LmFueSgpIHx8IG51bGxgLFxuICAgICdbYXR0ci5hY3Rpb25zXSc6IGBhY3Rpb25TbG90KCk/LmFueSgpIHx8IG51bGxgLFxuICAgICdbYXR0ci5ib2R5XSc6IGBib2R5U2xvdCgpPy5hbnkoKSB8fCBudWxsYCxcbiAgICAnW2F0dHIuc3RhdGVdJzogJ3N0YXRlKCknLFxuICB9LFxufSlcbmV4cG9ydCBjbGFzcyBEaWFsb2dDb21wb25lbnQgZXh0ZW5kcyBNYXRlcmlhbERlc2lnbkNvbXBvbmVudCB7XG4gIHJlYWRvbmx5IHJldHVyblZhbHVlID0gbW9kZWw8c3RyaW5nPigpO1xuICByZWFkb25seSBvcGVuID0gbW9kZWwoZmFsc2UpO1xuICByZWFkb25seSBjYW5jZWwgPSBvdXRwdXQoKTtcbiAgcHJpdmF0ZSByZWFkb25seSBfZGlhbG9nID0gdmlld0NoaWxkPEVsZW1lbnRSZWY8SFRNTERpYWxvZ0VsZW1lbnQ+PignZGlhbG9nJyk7XG5cbiAgcmVhZG9ubHkgaWNvblNsb3QgPSB0aGlzLnNsb3REaXJlY3RpdmUoJ2ljb24nKTtcbiAgcmVhZG9ubHkgaGVhZGxpbmVTbG90ID0gdGhpcy5zbG90RGlyZWN0aXZlKCdoZWFkbGluZScpO1xuICByZWFkb25seSBzdXBwb3J0aW5ndGV4dCA9IHRoaXMuc2xvdERpcmVjdGl2ZSgnc3VwcG9ydGluZy10ZXh0Jyk7XG4gIHJlYWRvbmx5IGFjdGlvblNsb3QgPSB0aGlzLnNsb3REaXJlY3RpdmUoJ2FjdGlvbicpO1xuICByZWFkb25seSBib2R5U2xvdCA9IHRoaXMuc2xvdERpcmVjdGl2ZSgpO1xuXG4gIHByaXZhdGUgcmVhZG9ubHkgX2RvY3VtZW50ID0gaW5qZWN0KERPQ1VNRU5UKTtcbiAgcHJpdmF0ZSByZWFkb25seSBfb3BlbkNsb3NlJCA9IG9wZW5DbG9zZSh0aGlzLm9wZW4sICdsb25nMycsICdsb25nMicpO1xuICByZWFkb25seSBzdGF0ZSA9IHRvU2lnbmFsKHRoaXMuX29wZW5DbG9zZSQsIHtcbiAgICBpbml0aWFsVmFsdWU6ICdjbG9zZWQnLFxuICB9KTtcbiAgcmVhZG9ubHkgc3RhdGVDaGFuZ2UgPSBvdXRwdXQ8T3BlbkNsb3NlU3RhdGU+KCk7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0b09ic2VydmFibGUodGhpcy5zdGF0ZSlcbiAgICAgIC5waXBlKFxuICAgICAgICB0YXAoKHgpID0+IHRoaXMuc3RhdGVDaGFuZ2UuZW1pdCh4KSksXG4gICAgICAgIHNraXAoMSksXG4gICAgICAgIHRhcCgoc3RhdGUpID0+IHtcbiAgICAgICAgICBpZiAoc3RhdGUgPT09ICdvcGVuaW5nJykge1xuICAgICAgICAgICAgdGhpcy5fZG9jdW1lbnQuYm9keS5zdHlsZS5vdmVyZmxvdyA9ICdoaWRkZW4nO1xuICAgICAgICAgICAgaWYgKGlzUGxhdGZvcm1Ccm93c2VyKHRoaXMucGxhdGZvcm1JZCkpIHtcbiAgICAgICAgICAgICAgdGhpcy5fZGlhbG9nKCk/Lm5hdGl2ZUVsZW1lbnQuc2hvd01vZGFsKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChzdGF0ZSA9PT0gJ2Nsb3NlZCcpIHtcbiAgICAgICAgICAgIHRoaXMuX2RvY3VtZW50LmJvZHkuc3R5bGUub3ZlcmZsb3cgPSAnJztcbiAgICAgICAgICAgIGlmIChpc1BsYXRmb3JtQnJvd3Nlcih0aGlzLnBsYXRmb3JtSWQpKSB7XG4gICAgICAgICAgICAgIHRoaXMuX2RpYWxvZygpPy5uYXRpdmVFbGVtZW50LmNsb3NlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgKVxuICAgICAgLnN1YnNjcmliZSgpO1xuICAgIHRoaXMuc2V0U2xvdHMoQnV0dG9uQ29tcG9uZW50LCAoY29tcG9uZW50KSA9PiB7XG4gICAgICBjb21wb25lbnQuaG9zdEVsZW1lbnQuc2xvdCA9ICdhY3Rpb24nO1xuICAgICAgY29tcG9uZW50LnZhcmlhbnQuc2V0KCd0ZXh0Jyk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIF9uZXh0Q2xpY2tJc0Zyb21Db250ZW50ID0gZmFsc2U7XG4gIHByaXZhdGUgX2VzY2FwZVByZXNzZWRXaXRob3V0Q2FuY2VsID0gZmFsc2U7XG5cbiAgb25EaWFsb2dDYW5jZWwoZXZlbnQ6IEV2ZW50KSB7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICB0aGlzLl9lc2NhcGVQcmVzc2VkV2l0aG91dENhbmNlbCA9IGZhbHNlO1xuICAgIHRoaXMub3Blbi5zZXQoZmFsc2UpO1xuICB9XG5cbiAgb25EaWFsb2dDbG9zZSgpIHtcbiAgICBpZiAoIXRoaXMuX2VzY2FwZVByZXNzZWRXaXRob3V0Q2FuY2VsKSB7XG4gICAgICB0aGlzLmNhbmNlbC5lbWl0KCk7XG4gICAgfVxuXG4gICAgdGhpcy5fZXNjYXBlUHJlc3NlZFdpdGhvdXRDYW5jZWwgPSBmYWxzZTtcbiAgICB0aGlzLl9kaWFsb2coKT8ubmF0aXZlRWxlbWVudD8uZGlzcGF0Y2hFdmVudChcbiAgICAgIG5ldyBFdmVudCgnY2FuY2VsJywgeyBjYW5jZWxhYmxlOiB0cnVlIH0pXG4gICAgKTtcbiAgfVxuXG4gIG9uRGlhbG9nS2V5RG93bihldmVudDogS2V5Ym9hcmRFdmVudCkge1xuICAgIGlmIChldmVudC5rZXkgIT09ICdFc2NhcGUnKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5fZXNjYXBlUHJlc3NlZFdpdGhvdXRDYW5jZWwgPSB0cnVlO1xuICAgIHNldFRpbWVvdXQoKCkgPT4gKHRoaXMuX2VzY2FwZVByZXNzZWRXaXRob3V0Q2FuY2VsID0gZmFsc2UpKTtcbiAgfVxuXG4gIG9uRGlhbG9nQ2xpY2soKSB7XG4gICAgaWYgKHRoaXMuX25leHRDbGlja0lzRnJvbUNvbnRlbnQpIHtcbiAgICAgIHRoaXMuX25leHRDbGlja0lzRnJvbUNvbnRlbnQgPSBmYWxzZTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmNhbmNlbC5lbWl0KCk7XG4gICAgdGhpcy5vcGVuLnNldChmYWxzZSk7XG4gIH1cblxuICBvbkNvbnRhaW5lckNvbnRlbnRDbGljaygpIHtcbiAgICB0aGlzLl9uZXh0Q2xpY2tJc0Zyb21Db250ZW50ID0gdHJ1ZTtcbiAgfVxufVxuIiwiPGRpdiBwYXJ0PVwic2NyaW1cIiBjbGFzcz1cInNjcmltXCI+PC9kaXY+XG48ZGlhbG9nIHBhcnQ9XCJkaWFsb2dcIiAjZGlhbG9nIFtyZXR1cm5WYWx1ZV09XCJyZXR1cm5WYWx1ZSgpIHx8IG51bGxcIiAoY2FuY2VsKT1cIm9uRGlhbG9nQ2FuY2VsKCRldmVudClcIlxuICAoY2xpY2spPVwib25EaWFsb2dDbGljaygpXCIgKGNsb3NlKT1cIm9uRGlhbG9nQ2xvc2UoKVwiIChrZXlkb3duKT1cIm9uRGlhbG9nS2V5RG93bigkZXZlbnQpXCI+XG4gIDxkaXYgcGFydD1cImNvbnRhaW5lclwiIGNsYXNzPVwiY29udGFpbmVyXCI+XG4gICAgPG1kLWVsZXZhdGlvbiBwYXJ0PVwiZWxldmF0aW9uXCIgW2xldmVsXT1cIjNcIiAvPlxuICAgIDxkaXYgcGFydD1cImNvbnRhaW5lci1jb250ZW50XCIgY2xhc3M9XCJjb250YWluZXItY29udGVudFwiIChjbGljayk9XCJvbkNvbnRhaW5lckNvbnRlbnRDbGljaygpXCI+XG4gICAgICA8ZGl2IHBhcnQ9XCJoZWFkZXJcIiBjbGFzcz1cImhlYWRlclwiPlxuICAgICAgICA8ZGl2IHBhcnQ9XCJpY29uXCIgY2xhc3M9XCJpY29uXCI+XG4gICAgICAgICAgPHNsb3QgbmFtZT1cImljb25cIj48L3Nsb3Q+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IHBhcnQ9XCJoZWFkbGluZVwiIGNsYXNzPVwiaGVhZGxpbmVcIj5cbiAgICAgICAgICA8c2xvdCBuYW1lPVwiaGVhZGxpbmVcIj48L3Nsb3Q+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IHBhcnQ9XCJzdXBwb3J0aW5nLXRleHRcIiBjbGFzcz1cInN1cHBvcnRpbmctdGV4dFwiPlxuICAgICAgICAgIDxzbG90ICNzdXBwb3J0aW5nVGV4dFNsb3QgbmFtZT1cInN1cHBvcnRpbmctdGV4dFwiPjwvc2xvdD5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICAgIDxkaXYgY2xhc3M9XCJzY3JvbGxlclwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiY29udGVudFwiPlxuICAgICAgICAgIDxzbG90Pjwvc2xvdD5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICAgIDxkaXYgcGFydD1cImFjdGlvbnNcIiAjYWN0aW9ucyBjbGFzcz1cImFjdGlvbnNcIj5cbiAgICAgICAgPHNsb3QgbmFtZT1cImFjdGlvblwiPjwvc2xvdD5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICA8L2Rpdj5cbjwvZGlhbG9nPiJdfQ==